# EchoCity Project Summary

**Дата изучения:** 2025-01-27  
**Проект:** EchoCity (ГдеСейчас)  
**Расположение:** `C:\dev\echocity`  
**Порт разработки:** 3010

## Краткое описание

EchoCity — платформа для поиска мест и услуг в городе с поддержкой голосового поиска. Позволяет пользователям находить заведения, оставлять отзывы, а бизнесам — управлять своими локациями и каталогом услуг.

## Технологический стек

- **Frontend:** Next.js 15 (App Router) + TypeScript + TailwindCSS
- **Backend:** Next.js API Routes + Prisma ORM
- **База данных:** Supabase PostgreSQL
- **Хранилище:** Supabase Storage (для фото пользователей)
- **Аутентификация:** Кастомная сессионная система (HTTP-only cookies)
- **Хеширование паролей:** bcrypt (10 rounds)
- **Валидация:** Zod

## Основные модули

### 1. Аутентификация
- Email/password регистрация и вход
- Yandex ID OAuth интеграция
- Роли: ADMIN, CITIZEN, BUSINESS_OWNER
- Управление сессиями через cookies

### 2. Профиль пользователя
- Редактирование профиля
- Загрузка аватара в Supabase Storage
- Галерея фотографий
- Настройки уведомлений

### 3. Бизнес-менеджмент
- Регистрация бизнеса (3-шаговый мастер)
- Управление местами (places)
- Каталог услуг с ценами
- Спецпредложения (specials)
- Верификация через Yandex Maps

### 4. Поиск и каталог
- Поиск мест по названию/описанию
- Фильтрация по городу и типу услуги
- Публичные страницы мест
- Отображение рейтингов и отзывов

### 5. Отзывы
- Создание отзывов (рейтинг 1-5, текст, дата посещения)
- Модерация (isPublished, isDeleted)
- Публичный API для получения отзывов

### 6. Админ-панель
- Управление городами
- Управление франшизами
- Статистика по местам

### 7. Интеграция с Yandex
- Yandex ID OAuth (вход через Яндекс)
- Yandex Maps Places API (верификация бизнесов)
- Поиск организаций в каталоге Yandex

## Структура базы данных

### Основные модели:
- **User** — пользователи с ролями
- **UserProfile** — расширенный профиль
- **Business** — бизнесы (с полями Yandex)
- **Place** — места/локации бизнесов
- **City** — города (могут быть привязаны к франшизе)
- **Franchise** — франшизы
- **ServiceCategory** — категории услуг
- **ServiceType** — типы услуг
- **PlaceService** — услуги в местах (с ценами и спецпредложениями)
- **Review** — отзывы пользователей
- **OAuthAccount** — привязанные OAuth аккаунты
- **UserPhoto** — фотографии пользователей

## Ключевые файлы

### Конфигурация:
- `package.json` — зависимости и скрипты
- `prisma/schema.prisma` — схема БД
- `.env` — переменные окружения (не в git)
- `supabase_keys.txt` — тестовые ключи Supabase (не в git)

### Документация:
- `README.md` — основная документация
- `HANDOFF_DOCUMENT.md` — документ передачи проекта
- `TECHNICAL_DOCUMENTATION.md` — техническая документация
- `IMPLEMENTATION_REVIEW.md` — обзор реализованных функций
- `docs/YANDEX_INTEGRATION.md` — руководство по Yandex интеграции

## Команды разработки

```bash
npm install              # Установка зависимостей
npm run dev              # Запуск dev-сервера (порт 3010)
npm run prisma:generate  # Генерация Prisma клиента
npm run prisma:deploy    # Применение миграций к Supabase
npm run prisma:seed      # Заполнение тестовыми данными
npm run prisma:studio    # Открыть Prisma Studio (порт 5555)
npm run import:services  # Импорт каталога услуг
```

## Текущий статус Git

- **Ветка:** `main`
- **Впереди origin/main:** 2 коммита
- **Изменённые файлы:** много (не закоммичены)
- **Новые файлы:** много (не отслеживаются)

## Переменные окружения

### Обязательные:
- `DATABASE_URL` — строка подключения к Supabase PostgreSQL
- `NEXT_PUBLIC_SUPABASE_URL` — URL проекта Supabase
- `SUPABASE_SERVICE_ROLE_KEY` — сервисный ключ Supabase
- `SUPABASE_USER_PHOTOS_BUCKET` — имя bucket для фото (default: "user-photos")

### Опциональные (Yandex):
- `YANDEX_CLIENT_ID` — OAuth client ID
- `YANDEX_CLIENT_SECRET` — OAuth client secret
- `YANDEX_OAUTH_REDIRECT_URI` — callback URL
- `YANDEX_MAPS_API_KEY` — ключ Maps API (серверный)
- `NEXT_PUBLIC_YANDEX_MAPS_API_KEY` — ключ Maps API (клиентский)

## Важные заметки

1. **Креденшалы:** Тестовые ключи хранятся в `supabase_keys.txt` (авторизовано для разработки)
2. **База данных:** Все операции используют Supabase PostgreSQL (нет локальной БД)
3. **Миграции:** Использовать `prisma migrate deploy` для Supabase (не `prisma migrate dev`)
4. **Сессии:** Текущая реализация использует простое JSON кодирование (для продакшена нужен JWT или зашифрованные сессии)
5. **Порт:** Dev-сервер работает на порту 3010
6. **Git:** Никогда не коммитить `.env` или `supabase_keys.txt` (они в `.gitignore`)

## Следующие шаги

1. Проверить наличие `.env` файла
2. Убедиться, что зависимости установлены
3. Проверить подключение к базе данных
4. Изучить конкретные задачи для работы

